<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Blank App</title>
    </head>
    <body>
        <button onClick="scan();">Scan</button>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript">
        var connectToDevice;
            function scan(){
                alert("Scan Started")
               ble.startScan([], function(device) {
                 var con = confirm('Connect to ' + device.name + '?');  
                 if(con){
                     connectToDevice = device.id;
                     ble.stopScan(function(){
                        ble.connect(connectToDevice, function (connected) { 
                            alert("Connected!"+ connected);
                            ble.startNotification(device.id, '0000fee4-0000-1000-8000-00805f9b34fb', '2a1e0005-fd51-d882-8ba8-b98c0000cd1e', function(val){
                                alert(String.fromCharCode.apply(null, new Uint16Array(val)));
                            }, function(err){
                                alert('Error in notification: ' + JSON.stringify(err));
                            });
                         }, function (err) { 
                             alert("Connection failure: " + JSON.stringify(err));
                             ble.connect(connectToDevice, connectedDevice, disconnectedDevice) 
                        }) 
                     });
                     
                 }
            }, function(err){alert("Scan failed: " + err)});

            setTimeout(ble.stopScan,
                10000,
                function() { alert("Scan complete"); },
                function() { alert("stopScan failed"); }
            );
            }

            

                         
        </script>
    </body>
</html>
