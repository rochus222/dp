<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Blank App</title>
    </head>
    <body>
        <button onClick="scan();">Scan</button>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript">
            var bonded = [];
            function scan(){
                
                bluetoothle.initialize(function(status){alert(JSON.stringify(status));}, {
                    "request": true,
                    "statusReceiver": false,
                    "restoreKey" : "bluetoothleplugin"
                    });

                bluetoothle.startScan(function(device) {
                    if(!device.address) return;
                    var con = confirm('Connect to ' + JSON.stringify(device) + '?'); 
                    if(con){
                        bluetoothle.stopScan();
                        bluetoothle.discover(function(status) {
                            alert(JSON.stringify(status))
                        }, function(err) { 
                             alert("Bond error: " + JSON.stringify(err));
                             //ble.disconnect(device.id);
                        }, {address : device.address});
                    }
                }, function(err) { 
                             alert("Connection failure: " + JSON.stringify(err));
                             //ble.disconnect(device.id,);
                        }, {});
                

               /* alert("Scan Started")
               ble.startScan([], function(device) {
                 var con = confirm('Connect to ' + device.name + '?');  
                 if(con){
                     ble.connect(device.id, function(connected) { 
                            alert("Connected!"+ JSON.stringify(connected));
                            ble.read(device.id, '0000fee4-0000-1000-8000-00805f9b34fb', '2a1e0005-fd51-d882-8ba8-b98c0000cd1e', function(val){
                                alert('value: ' + val);
                            }, function(err){
                                alert('Error in notification: ' + JSON.stringify(err));
                            });
                         }, function(err) { 
                             alert("Connection failure: " + JSON.stringify(err));
                             ble.disconnect(device.id,);
                        });
                 }
            }, function(err){alert("Scan failed: " + err)});

            setTimeout(ble.stopScan,
                10000,
                function() { alert("Scan complete"); },
                function() { alert("stopScan failed"); }
            );*/
            }
        </script>
    </body>
</html>
